-- Databricks notebook source
-- MAGIC %md
-- MAGIC # General Social Survey
-- MAGIC ### Essential variables exploration
-- MAGIC 
-- MAGIC This notebook imports data from [General Social Survey](https://gss.norc.org/) (GSS). It is part of the [GeneralSocialSurvey](https://github.com/CulleyHarrelson/GeneralSocialSurvey) github repository.

-- COMMAND ----------

DROP TABLE IF EXISTS gss.raw_survey_latest;


-- COMMAND ----------

-- MAGIC %python
-- MAGIC 
-- MAGIC import pandas as pd
-- MAGIC 
-- MAGIC def columns():
-- MAGIC 
-- MAGIC     return [
-- MAGIC     'year',
-- MAGIC     'id',
-- MAGIC     'wrkstat',
-- MAGIC     'divorce',
-- MAGIC     'marital',
-- MAGIC     'martype',
-- MAGIC     'sibs',
-- MAGIC     'childs',
-- MAGIC     'age',
-- MAGIC     'educ',
-- MAGIC     'degree',
-- MAGIC     'sex',
-- MAGIC     'race',
-- MAGIC     'racecen1',
-- MAGIC     'racecen2',
-- MAGIC     'racecen3',
-- MAGIC     'res16',
-- MAGIC     'reg16',
-- MAGIC     'adults',
-- MAGIC     'income',
-- MAGIC     'rincome',
-- MAGIC     'region',
-- MAGIC     'srcbelt',
-- MAGIC     'partyid',
-- MAGIC     'pres96',
-- MAGIC     'pres00',
-- MAGIC     'pres04',
-- MAGIC     'pres08',
-- MAGIC     'pres12',
-- MAGIC     'polviews',
-- MAGIC     'natspac',
-- MAGIC     'natenvir',
-- MAGIC     'natheal',
-- MAGIC     'natcity',
-- MAGIC     'natcrime',
-- MAGIC     'natdrug',
-- MAGIC     'nateduc',
-- MAGIC     'natrace',
-- MAGIC     'natarms',
-- MAGIC     'nataid',
-- MAGIC     'natfare',
-- MAGIC     'natroad',
-- MAGIC     'natsoc',
-- MAGIC     'natmass',
-- MAGIC     'natpark',
-- MAGIC     'natchld',
-- MAGIC     'natsci',
-- MAGIC     'natenrgy',
-- MAGIC     'spkath',
-- MAGIC     'colath',
-- MAGIC     'libath',
-- MAGIC     'spksoc',
-- MAGIC     'colsoc',
-- MAGIC     'libsoc',
-- MAGIC     'spkrac',
-- MAGIC     'colrac',
-- MAGIC     'librac',
-- MAGIC     'spkcom',
-- MAGIC     'colcom',
-- MAGIC     'libcom',
-- MAGIC     'spkmil',
-- MAGIC     'colmil',
-- MAGIC     'libmil',
-- MAGIC     'spkhomo',
-- MAGIC     'colhomo',
-- MAGIC     'libhomo',
-- MAGIC     'spkmslm',
-- MAGIC     'colmslm',
-- MAGIC     'libmslm',
-- MAGIC     'cappun',
-- MAGIC     'gunlaw',
-- MAGIC     'grass',
-- MAGIC     'relig',
-- MAGIC     'fund',
-- MAGIC     'attend',
-- MAGIC     'reliten',
-- MAGIC     'postlife',
-- MAGIC     'pray',
-- MAGIC     'popespks',
-- MAGIC     'relig16',
-- MAGIC     'prayer',
-- MAGIC     'bible',
-- MAGIC     'racmar',
-- MAGIC     'racdin',
-- MAGIC     'racpush',
-- MAGIC     'racseg',
-- MAGIC     'racopen',
-- MAGIC     'raclive',
-- MAGIC     'racclos',
-- MAGIC     'racdis',
-- MAGIC     'racinteg',
-- MAGIC     'rachome',
-- MAGIC     'racschol',
-- MAGIC     'racfew',
-- MAGIC     'rachaf',
-- MAGIC     'racmost',
-- MAGIC     'racpres',
-- MAGIC     'racchurh',
-- MAGIC     'affrmact',
-- MAGIC     'happy',
-- MAGIC     'hapmar',
-- MAGIC     'health',
-- MAGIC     'life',
-- MAGIC     'helpful',
-- MAGIC     'fair',
-- MAGIC     'trust',
-- MAGIC     'confinan',
-- MAGIC     'conbus',
-- MAGIC     'conclerg',
-- MAGIC     'coneduc',
-- MAGIC     'confed',
-- MAGIC     'conlabor',
-- MAGIC     'conpress',
-- MAGIC     'conmedic',
-- MAGIC     'contv',
-- MAGIC     'conjudge',
-- MAGIC     'consci',
-- MAGIC     'conlegis',
-- MAGIC     'conarmy',
-- MAGIC     'satjob',
-- MAGIC     'class',
-- MAGIC     'satfin',
-- MAGIC     'finrela',
-- MAGIC     'union',
-- MAGIC     'fehome',
-- MAGIC     'fework',
-- MAGIC     'fepres',
-- MAGIC     'fepol',
-- MAGIC     'abdefect',
-- MAGIC     'abnomore',
-- MAGIC     'abhlth',
-- MAGIC     'abpoor',
-- MAGIC     'abrape',
-- MAGIC     'absingle',
-- MAGIC     'abany',
-- MAGIC     'chldidel',
-- MAGIC     'sexeduc',
-- MAGIC     'divlaw', # replaced 2021 with divlawnv and divlawv p. 245
-- MAGIC     'divlawv',
-- MAGIC     'famdif16',
-- MAGIC     'divlawnv',
-- MAGIC     'premarsx',
-- MAGIC     'teensex',
-- MAGIC     'xmarsex',
-- MAGIC     'homosex',
-- MAGIC     'pornlaw',
-- MAGIC     'spanking',
-- MAGIC     'letdie1',
-- MAGIC     'polhitok',
-- MAGIC     'polabuse',
-- MAGIC     'polmurdr',
-- MAGIC     'polescap',
-- MAGIC     'polattak',
-- MAGIC     'fear',
-- MAGIC     'owngun',
-- MAGIC     'pistol',
-- MAGIC     'rowngun',
-- MAGIC     'hunt',
-- MAGIC     'phone',
-- MAGIC     'fechld',
-- MAGIC     'fehelp',
-- MAGIC     'fepresch',
-- MAGIC     'fefam',
-- MAGIC     'racdif1',
-- MAGIC     'racdif2',
-- MAGIC     'racdif3',
-- MAGIC     'racdif4',
-- MAGIC     'god',
-- MAGIC     'reborn',
-- MAGIC     'savesoul',
-- MAGIC     'racwork',
-- MAGIC     'fejobaff',
-- MAGIC     'discaffm',
-- MAGIC     'discaffw',
-- MAGIC     'fehire',
-- MAGIC     'relpersn',
-- MAGIC     'sprtprsn',
-- MAGIC     'relexp',
-- MAGIC     'spklang',
-- MAGIC     'compuse',
-- MAGIC     'hrsrelax',
-- MAGIC     'trdunion',
-- MAGIC     'wkracism',
-- MAGIC     'wksexism',
-- MAGIC     'wkharsex',
-- MAGIC     'databank',
-- MAGIC     'goodlife',
-- MAGIC     'meovrwrk',
-- MAGIC     'miracles',
-- MAGIC     'relexper',
-- MAGIC     'relactiv',
-- MAGIC     'matesex',
-- MAGIC     'frndsex',
-- MAGIC     'acqntsex',
-- MAGIC     'pikupsex',
-- MAGIC     'paidsex',
-- MAGIC     'othersex',
-- MAGIC     'sexsex',
-- MAGIC     'sexfreq',
-- MAGIC     'sexsex5',
-- MAGIC     'sexornt',
-- MAGIC     'hhrace',
-- MAGIC     'cohort',
-- MAGIC     'ballot',
-- MAGIC     'wtssall',
-- MAGIC     'wtssps',
-- MAGIC     'sexbirth',
-- MAGIC     'sexnow',
-- MAGIC     'eqwlth',
-- MAGIC     'realinc',
-- MAGIC     'realrinc',
-- MAGIC     'coninc',
-- MAGIC     'conrinc',
-- MAGIC     'commun',
-- MAGIC     'cantrust',
-- MAGIC     'zodiac',
-- MAGIC     ]
-- MAGIC 
-- MAGIC # url contains temporary credentials.  Create a new url to import again.
-- MAGIC # todo 
-- MAGIC url = 'https://general-social-survey.s3.us-east-1.amazonaws.com/gss7221_r2.dta?response-content-disposition=inline&X-Amz-Security-Token=IQoJb3JpZ2luX2VjEJ%2F%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLXdlc3QtMSJIMEYCIQDqAJseiGlzNwU0YaMwI2n4RJzLW4bODCaE29Q1qLKrYgIhAI4esKyafGLk%2BU5B5F74F9FKqDSaNnG0LiJHdMJRxHG8KuQCCEgQABoMOTEzNTI2NzQxMTA0IgyROdlVf7VDL2DL8RMqwQLwFqJZDCa2JYSPjR7V0zn1xJhUS%2BAJ6B691rOJ%2FWZWGi3DuVE85iY%2FH2cPdyh%2B%2B6S0EYb5t43YM1Wgg5mz3gTOX7mVvNqqMK2po0XUM6UlpMN%2BB8AcsCxZPsrRYIs8k%2FqfMDyenqXa1zgVpOXAqWf5Mb%2FvkiTIHYSwO5kn9KwAruO7twav98vjsHxUpMoEKe2PmFLi%2FcvBBGPUD1RN7gLDwBVEx%2BBwXZZf3NpaQ0Ut3czFBP0YRqZ0yXyTAzOLkHSvvup1e7Gj2V0aOECCaFSEpqPKculLJNpMdcA2Kro9Dcb8n2zQtctp7Ugyvutz%2BN6f1vM3XYED2OgDj%2B7fgLVU4ukEwl34ZdUXlfkt02Z0cxwsmfDNfrMBAXm1TRbehlXlya6evDPbcji1oNAbNw%2Bb4wc1QhzknPuItnA40jyzhlowsNntnwY6sgJ4lBc8k99E%2FMhDVnNxuLURkwdWbGSnWhdViH0d5UgYgeSFWGD%2FmNYsg5x7W14LnWspTxhmIr1QTm9ArtpGq8ZyLHB07rASdlW1wazhJcVOT7iD5F9Hgruti3VrMNe2qLbuxqbl3864tAoGKpav5%2FPulr19mcIjqE2j6TaMlX0JG%2BxDJbhlQXnvIWPjYz8YANWNI%2BZ2It6Fk%2Flq8H0AHZTSkWbly3gb7FsqkPT%2Fm03vtyoEHX%2Fbna3ym8pmMmu%2BES0A%2FM68SIP2sz%2By8gdNvV9UHdWLr%2BXbfza93StupQTgEcSksLW7co8avIkQUxiddAvDssIPhGJNd5XgzF4vDJSU54m4dWbj6FU1vNOup1QiUrg8CdPV1ZmNCjiy4j9AhMNnkQrSP8on9iuugXS43x6zKQw%3D&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Date=20230226T142928Z&X-Amz-SignedHeaders=host&X-Amz-Expires=43200&X-Amz-Credential=ASIA5JMTP3BYHULW7R6Q%2F20230226%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Signature=df68439ae5f5f708a9fff2d09589d2ec5d37c4eb690a12b21434e9168def05f6'
-- MAGIC 
-- MAGIC 
-- MAGIC gss_pd = pd.read_stata(url, columns=columns(), convert_categoricals=False)
-- MAGIC 
-- MAGIC gss_ps = spark.createDataFrame(gss_pd)
-- MAGIC gss_ps.write.saveAsTable("gss.raw_survey_latest")
